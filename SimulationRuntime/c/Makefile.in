# Adrian Pop, adrpo@ida.liu.se, Martin Sj√∂lund, marsj@ida.liu.se
# - Use make -f Makefile.omdev.mingw if you want to compile on Windows/MinGW
# - Please leave the UNIX Makefile as it is if you are not using UNIX/Linux
# If you need to add files, etc, you modify Makefile.common - a common file
# for both UNIX/Linux and Windows platforms.

top_builddir = ../..
builddir_bin=$(top_builddir)/build/bin
builddir_lib=$(top_builddir)/build/lib/omc
builddir_inc=$(top_builddir)/build/include/omc

AR = @AR_SH@
CC = @CC@
CXX = @CXX@
CONFIG_CPPFLAGS = @CPPFLAGS@
CONFIG_CFLAGS = @CFLAGS@ @IPOPT_CFLAGS@
FPMATHFORTRAN = @FPMATHFORTRAN@
LDFLAGS=-L$(top_builddir)/build/lib/omc @RT_LDFLAGS@ 
LDFLAGS_SIM=-L$(top_builddir)/build/lib/omc -L../interactive @RT_LDFLAGS_SIM@

LIBMAKEFILE = Makefile
INTERACTIVELIBS = "-lpthread"
INTERACTIVECLIENT = ../interactive/SampleClient/interactiveclient@EXE@
QMAKE=@QMAKE@
CONFIG_H=$(top_builddir)/Compiler/runtime/config.h $(top_builddir)/Compiler/runtime/config.unix.h
# Use f2c from the OS itself... If so, don't include the f2c headers from OpenModelica
LIBF2C=@LIBF2C@
ifeq ($(LIBF2C),)
else
LIBF2CINC=-I./simulation/libf2c/
LIBF2CHEADER=./simulation/libf2c/f2c.h
endif
LIBSIMULATION=@LIBSIMULATION@
LIBRUNTIME=@LIBRUNTIME@
LIBFMIRUNTIME=@LIBFMIRUNTIME@
OBJ_EXT = .o

REGEN = Makefile.in

include Makefile.common

Makefile: Makefile.in
	cd $(top_builddir); ./config.status

emcc: Makefile emcc/pre.js
	cp /usr/include/expat*.h .
	emmake $(MAKE) OBJ_EXT=.bc CC=emcc CXX=emcc CFLAGS=" $(CPPFLAGS) -Os -DOMC_EMCC -DNO_INTERACTIVE_DEPENDENCY -I./simulation/libf2c/" libSimulationRuntimeC.bc
	emmake $(MAKE) -C simulation/libf2c OBJ_EXT=.bc CC=emcc CXX=emcc CFLAGS="-Os" libf2c.bc
	cp emcc/pre.js libSimulationRuntimeC.bc simulation/libf2c/libf2c.bc $(builddir_lib)/emcc/
emcc-clean: Makefile
	$(MAKE) OBJ_EXT=.bc clean
