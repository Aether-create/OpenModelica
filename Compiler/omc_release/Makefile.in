#
# Makefile for omc
#
# $Id$
#

LIBSOCKET = @LIBSOCKET@
LIBLPSOLVE55 = @LIBLPSOLVE55@

USE_CORBA = @USE_CORBA@
USE_GRAPH = @USE_GRAPH@
SHELL	= /bin/sh
CC	= @CC@
OMPCC = @OMPCC@
CFLAGS	= @CFLAGS@
RMLHOME	= @rmlhome@
RMLINC  = -I$(RMLHOME)/include/plain
FMILIB = -lfmilib -lOpenModelicaFMIRuntimeC

EXEEXT  = @EXEEXT@

srcdir = ..
top_builddir = ../..

ifdef USE_CORBA
 CORBALIBS=@CORBALIBS@
else
 CORBALIBS=
endif

ifdef USE_GRAPH
 USE_METIS=@USE_METIS@
 USE_PATOH=@USE_PATOH@
 ifeq ($(USE_METIS),1)
    METISHOME=@METISHOME@
    METISLIB=$(METISHOME)/lib/libmetis.a
 endif
 ifeq ($(USE_PATOH),1)
    PATOHHOME=@PATOHHOME@
    PATOHLIB=$(PATOHHOME)/libpatoh.a
 endif
endif

LDFLAGS = @LDFLAGS@ -lm -L$(RMLHOME)/lib/plain -lrml $(LIBSOCKET) $(CORBALIBS) $(LIBLPSOLVE55) $(METISLIB) $(PATOHLIB) -L../../build/lib/omc @RPATH@ @OMC_LIBS@ -lgc -lexpat @RT_LDFLAGS@

PROG = omc
RMLC	= @rmlc_bin@
RML	= $(RMLHOME)/bin/rml
RMLCFLAGS = -Wr,-Wshow-warnings@RML_TRACE@,$(RMLC_INCLUDE_ALL_DIRS)

MAKETARGET = Makefile
include $(srcdir)/Makefile.compiler_subdirs.common
.testvariables:
	# You're using the proper Unix Makefile. Thanks for making my life easier.

$(PROG):
	$(MAKE) DAE.c
	$(MAKE) allobjs $(SUBDIRS)
	$(OMPCC) $(CFLAGS) -o $(PROG)$(EXEEXT) $(SRCO) $(AST) $(RTOBJ) $(LDFLAGS) $(FMILIB) -lstdc++

nolink:
	$(MAKE) -C Template
	$(MAKE) .depend
	$(MAKE) DAE.c
	$(MAKE) allobjs $(SUBDIRS)

allobjs: $(SRCO)
